 <?php

$objectManager = \Magento\Framework\App\ObjectManager::getInstance();
$request = $objectManager->get('Magento\Framework\App\Action\Context')->getRequest();
$basemediaurl = $objectManager->get('Magento\Store\Model\StoreManagerInterface')
                    ->getStore()
                    ->getBaseUrl(\Magento\Framework\UrlInterface::URL_TYPE_MEDIA);

  date_default_timezone_set('Asia/Kolkata');


$currentTime = date('h:i:A');
$currenDate= date('d.m.Y');
$str= explode(":",$currentTime);
list($hr, $min, $timestamp) = $str; 
$live_sku = "LIVE_SHOPPING";

//$formsubmiturl = $block->getUrl('videoform/index/postnew');


if ($request->getFullActionName() == 'catalog_category_view' || $request->getFullActionName() == 'catalogsearch_result_index' ) {
?>
<div class="bottom-nav-container">
  <div class="bottom-nav-bar">
    <nav class="bottom-nav">
       <div class="bottom-nav-item sorfilter"style="border-right: 1px solid #fff;">
        <div class="bottom-nav-link">
          <span>SORT</span>
        </div>
      </div>
       <div class="bottom-nav-item filtersort"style="border-right: 1px solid #fff;">
        <div class="bottom-nav-link">
          <span>FILTER</span>
        </div>
      </div>
      <div class="bottom-nav-item active">
        <div  id="live-shop" class="bottom-nav-link" style="border-right: 1px solid #fff;">
          <img src="<?php echo $basemediaurl; ?>live_shopping_icon.png" width="35px" />
          <span>LIVE SHOPPING</span>
        </div>
      </div>
      <div class="bottom-nav-item">
        <div class="bottom-nav-link">
           <img src="<?php echo $basemediaurl; ?>message_icon.png" width="40px" />
        </div>
      </div>
    </nav>
  </div>
    <div id="popover-content" class="popover-content close" style="bottom: 50px;">
      <button type="button" class="btn btn-default btnclose" id="btnclose">x</button>
      <div class="live-form-content" style="display: block; bottom: 0;">
     <!--  <div class="video-intro-text" style="text-align: center;">
      <h3>Get Your Appointment</h3>
      <h5>Fill the details</h5>
    </div> -->
      <form class="form-horizontal" enctype="multipart/form-data"  id="live-form" method="POST"
      data-hasrequired="<?php /* @escapeNotVerified */ echo __('* Required Fields') ?>" data-mage-init='{"validation":{}}'>
         <input name="type" value="Video_Shopping"  type="hidden" />
                         <input name="hrs" value="<?php echo $hr; ?>"  type="hidden" />
                         <input name="min" value="<?php echo $min; ?>"  type="hidden" />
                         <input name="meri" value="<?php echo $timestamp; ?>"  type="hidden" />
                         <input name="language" value="any"  type="hidden" />
                         <input name="fullname" value="Guest"  type="hidden" />
                         <input name="email" value="dummyguest@gmail.com"  type="hidden" />
                         <input name="product" value="<?php echo $live_sku; ?>"  type="hidden" />
                         <input name="takedate" value="<?php echo $currenDate; ?>"  type="hidden" />
                         <?php echo $block->getBlockHtml('formkey')?>
<fieldset>
<!-- <div class="form-group"> 
  <div class="col-md-8">
  <input  name="fullname" type="text" placeholder="Enter Name" class="form-control input-md required-entry in"> 
  </div>
</div> -->
<div class="form-group loader-block" style="display: none;margin-bottom: 0px;">
   <div class="row success-block" style="flex-direction: column;justify-content: center;align-items: center;">
  <div class="col-12" style="color:#8bd8bd">
   <div class="loader-icon">Loading...</div>
  </div>
  </div>
  </div>
  
<div class="form-group success-block" style="margin-bottom: 5rem;display: none;">
  <div class="row success-block" style="flex-direction: column;justify-content: center;align-items: center;">
  <div class="col-12" style="color:#8bd8bd">
    <h3 style="text-align: center;">Your details has been submitted successfully</h3>
    <h5 style="text-align: center;">Our team will contact very soon</h5>
  </div>
  </div>
</div>
<div class="form-group form-block">
  <div class="row" style="flex-direction: column;justify-content: center;align-items: center;">
    <div class="col-8">
  <input  id="live_mobile" style="border-radius: 10px;" name="mobile" type="tel" placeholder="*Mobile No" class="form-control input-md required-entry in">
    <span id="errmsg" style="color: red;text-align:center;"></span>
  </div>
  <div class="col-4">
 <div style="text-align: center;">
<button type="submit" id="live_submit" style="color: #fff !important;" class="btn btn-primary live-video-btn">Submit</button>
</div>
  </div>
  </div>
</div>
</fieldset>
</form>
</div>
    </div>
</div>


<?php } else  { ?>

<div class="bottom-nav-container">
  <div class="bottom-nav-bar">
    <nav class="bottom-nav">
      <div class="bottom-nav-item active">
        <div  id="live-shop" class="bottom-nav-link" style="border-right: 1px solid #fff;">
          <img src="<?php echo $basemediaurl; ?>live_shopping_icon.png" width="35px" />
          <span>LIVE SHOPPING</span>
        </div>
      </div>
      <?php

       if ($request->getFullActionName() == 'catalog_product_view') {
       ?>
      <div class="bottom-nav-item"style="border-right: 1px solid #fff;" onclick="location.href='/try-at-home?utm_source=website&utm_medium=mobile&utm_campaign=sticky_footer/';">
        <div class="bottom-nav-link">
           <img src="<?php echo $basemediaurl; ?>try_on_icon.png" width="25px" />
          <span>TRY AT HOME</span>
        </div>
      </div>
       <?php
} else {
       ?>
        <div class="bottom-nav-item"style="border-right: 1px solid #fff;" onclick="location.href='/try-on?utm_source=website&utm_medium=mobile&utm_campaign=sticky_footer/';">
        <div class="bottom-nav-link">
           <img src="<?php echo $basemediaurl; ?>try_on_icon.png" width="25px" />
          <span>TRY ON</span>
        </div>
      </div>
       <?php
}
       ?>
      <div class="bottom-nav-item">
        <div class="bottom-nav-link">
           <img src="<?php echo $basemediaurl; ?>message_icon.png" width="40px" />
        </div>
      </div>
    </nav>
  </div>
    <div id="popover-content" class="popover-content close" style="bottom: 50px;">
      <button type="button" class="btn btn-default btnclose" id="btnclose">x</button>
      <div class="live-form-content" style="display: block; bottom: 0;">
     <!--  <div class="video-intro-text" style="text-align: center;">
      <h3>Get Your Appointment</h3>
      <h5>Fill the details</h5>
    </div> -->
      <form class="form-horizontal" enctype="multipart/form-data"  id="live-form" method="POST"
      data-hasrequired="<?php /* @escapeNotVerified */ echo __('* Required Fields') ?>" data-mage-init='{"validation":{}}'>
         <input name="type" value="Video_Shopping"  type="hidden" />
                         <input name="hrs" value="<?php echo $hr; ?>"  type="hidden" />
                         <input name="min" value="<?php echo $min; ?>"  type="hidden" />
                         <input name="meri" value="<?php echo $timestamp; ?>"  type="hidden" />
                         <input name="language" value="any"  type="hidden" />
                         <input name="fullname" value="Guest"  type="hidden" />
                         <input name="email" value="dummyguest@gmail.com"  type="hidden" />
                         <input name="product" value="<?php echo $live_sku; ?>"  type="hidden" />
                         <input name="takedate" value="<?php echo $currenDate; ?>"  type="hidden" />
                         <?php echo $block->getBlockHtml('formkey')?>
<fieldset>
<!-- <div class="form-group"> 
  <div class="col-md-8">
  <input  name="fullname" type="text" placeholder="Enter Name" class="form-control input-md required-entry in"> 
  </div>
</div> -->
<div class="form-group loader-block" style="display: none;margin-bottom: 0px;">
   <div class="row success-block" style="flex-direction: column;justify-content: center;align-items: center;">
  <div class="col-12" style="color:#8bd8bd">
   <div class="loader-icon">Loading...</div>
  </div>
  </div>
  </div>
  
<div class="form-group success-block" style="margin-bottom: 5rem;display: none;">
  <div class="row success-block" style="flex-direction: column;justify-content: center;align-items: center;">
  <div class="col-12" style="color:#8bd8bd">
    <h3 style="text-align: center;">Your details has been submitted successfully</h3>
    <h5 style="text-align: center;">Our team will contact very soon</h5>
  </div>
  </div>
</div>
<div class="form-group form-block">
  <div class="row" style="flex-direction: column;justify-content: center;align-items: center;">
    <div class="col-8">
  <input  id="live_mobile" style="border-radius: 10px;" name="mobile" type="tel" placeholder="*Mobile No" class="form-control input-md required-entry in">
    <span id="errmsg" style="color: red;text-align:center;"></span>
  </div>
  <div class="col-4">
 <div style="text-align: center;">
<button type="submit" id="live_submit" style="color: #fff !important;" class="btn btn-primary live-video-btn">Submit</button>
</div>
  </div>
  </div>
</div>
</fieldset>
</form>
</div>
    </div>
</div>



<?php } ?>

 <script type="text/javascript">
require([
    'jquery',
    'mage/mage'
], function($){
 $(document).ready(function(){
  var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    $("html, body").css({"width":w,"height":h});
  $('#live-shop,#btnclose').click(function() {
  $('.popover-content').toggleClass('close');
});
  $(document).on('focus', 'input', function() {
    document.querySelector('input').scrollIntoView();
});

var dataForm = $('#live-form');
   dataForm.mage('validation', {});

   jQuery("#live-form").submit(function(e){
    e.preventDefault();

var status = dataForm.validation('isValid'); //validates form and returns boolean
if(status){
  $(".form-block").hide();
  $(".loader-block").show();
   setTimeout(function(){
             $(".loader-block").hide();
             $(".success-block").show();
}, 3000);
  var fd = new FormData($('form#live-form')[0]);
 $.ajax({
    type: "POST",
    url: "<?php echo $block->getUrl('videoform/index/livevideoshop'); ?>",
    data : $(this).serialize(),
    success: function (data) {
        if (data == "success") {
            $('#live-form')[0].reset();
            setTimeout(function(){
            $(".success-block").hide();
            $(".form-block").show();
}, 5000); 
            
        } else {
           alert(data);
        }
    },
    error: function (jqXHR, textStatus, errorThrown) {
                   // error handling
    }
});
}else{
return false;

}

   });

}); 

   function setInputFilter(textbox, inputFilter) {
  ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function(event) {
    textbox.addEventListener(event, function() {
      if (inputFilter(this.value)) {
        this.oldValue = this.value;
        this.oldSelectionStart = this.selectionStart;
        this.oldSelectionEnd = this.selectionEnd;
      } else if (this.hasOwnProperty("oldValue")) {
        this.value = this.oldValue;
        this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
      } else {
        this.value = "";
      }
    });
  });
}
setInputFilter(document.getElementById("live_mobile"), function(value) {
  return /^-?\d*$/.test(value); });
}); 
</script> 
